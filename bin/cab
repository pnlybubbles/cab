#!/bin/sh

case $1 in
  '' | 'start' )
    docker run \
      -v /Users/pnlybubbles/cab:/cab \
      -v /var/run/docker.sock:/var/run/docker.sock \
      --name cab \
      --label cab.primary \
      --rm \
      -itd \
      cab \
      sh
    ;;
  'stop' )
    primary=`docker ps -qf 'label=cab.primary'`
    if [ ! -z "$primary" ]; then
      docker stop $primary
    fi
    replica=`docker ps -qf 'label=cab.replica'`
    if [ ! -z "$replica" ]; then
      docker stop $replica
    fi
    ;;
  'sh' )
    docker exec \
      -it \
      cab \
      script -c 'tmux'
    ;;
  'clean' )
    img=`docker images -f 'dangling=true' -q`
    if [ ! -z "$img" ]; then
      docker rmi $img
    fi
    ;;
  'build' )
    docker build \
      -t cab \
      /Users/pnlybubbles/cab
    ;;
  * )
    echo 'ERROR: Unknown arguments'
    return 1
    ;;
esac
